<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Create Post</title>
</head>
<body>
    <h1>Create a New Post</h1>

    <form id="postForm">
        <label for="author">Author:</label>
        <input type="text" id="author" required><br>

        <label for="title">Title of the Book:</label>
        <input type="text" id="title" required><br>

        <label for="rating">Ratings (1 to 5):</label>
        <input type="number" id="rating" min="1" max="5" required><br>

        <label for="review">Review:</label>
        <textarea id="review" required></textarea><br>

        <label for="genre">Genre:</label>
        <select id="genre" required>
            <option value="fantasy">Fantasy</option>
            <option value="science-fiction">Science Fiction</option>
            <!-- Add more genre options here -->
        </select><br>

        <button type="submit">Submit</button>
    </form>

    <script type="module">
        // Import necessary Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Initialize Firebase with your configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDSVB_m--vKWpFjpa1PSyZoF7slhTdGN08",
            authDomain: "bookweb-99ef4.firebaseapp.com",
            databaseURL: "https://bookweb-99ef4-default-rtdb.firebaseio.com",
            projectId: "bookweb-99ef4",
            storageBucket: "bookweb-99ef4.appspot.com",
            messagingSenderId: "415676602525",
            appId: "1:415676602525:web:5ed67a9357cc9e3b88dc74",
            measurementId: "G-VDFL9E4XYJ"
        };
        const app = initializeApp(firebaseConfig);

        // Function to submit the post
        async function submitPost(event) {
            event.preventDefault();

            // Get form values
            const author = document.getElementById('author').value;
            const title = document.getElementById('title').value;
            const rating = document.getElementById('rating').value;
            const review = document.getElementById('review').value;
            const genre = document.getElementById('genre').value; // New: Get selected genre

            // Check if author and title are provided
            if (!author || !title) {
                alert("Please provide both author and title!");
                return;
            }

            // Check if the book already exists in Firestore
            const firestore = getFirestore(app);
            const booksRef = collection(firestore, 'books');
            const q = query(booksRef, where('author', '==', author), where('title', '==', title));
            const querySnapshot = await getDocs(q);

            // If the book already exists in Firestore, prompt the user to check the information
            if (!querySnapshot.empty) {
                alert("This book already exists in the database. Please verify the information provided.");
                return;
            }

            // Create a new document in the 'books' collection
            try {
                await addDoc(collection(firestore, "books"), {
                    author: author,
                    title: title,
                    genre: genre,
                    rating: rating,
                    review: review
                });
                alert("Post added successfully!");
                window.location.href = 'start.html'; // Redirect to start page after successful submission
            } catch (error) {
                console.error("Error adding document: ", error);
                alert("Error adding document. Please try again later.");
            }
        }

        // Event listener for form submission
        document.getElementById('postForm').addEventListener('submit', submitPost);

    </script>
</body>
</html>
